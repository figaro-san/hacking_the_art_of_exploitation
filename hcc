#!/bin/sh

# これはアドレス空間配置のランダム化(ASLR)とcanaryを無効化し、32ビットでコンパイルするためのスクリプト

is_randomize=$(sudo sysctl -a | grep randomize | awk '{print $3}')
if [ $is_randomize != 0 ]; then
	echo Detect: randomize is on
	echo Set: kernel.randomize_va_space=0
	sudo sysctl -w kernel.randomize_va_space=0
fi

source_code=$1
if [ -f $source_code ]; then
	gcc -o $(echo $source_code | tr -d '.c') $source_code -g -fno-stack-protector -m32

else 
	echo $source_code does not exist

fi

echo Do not forget to run 'sudo sysctl -w kernel.randomize_va_space=2'
